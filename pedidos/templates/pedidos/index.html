{% extends 'pedidos/base.html' %}
{% load static %}

{% block content %}
<!-- ===== HERO responsive (con imagen) ===== -->
<section class="hero-card mt-3">
  <div class="hero-copy">
    <h1>La mejor calidad de helado</h1>
    <p>Disfrutá Yo Heladerías en casa.</p>
    {# Botón eliminado intencionalmente #}
  </div>
  <div class="hero-illustration">
    <img
      src="{% static 'pedidos/img/hero-scooter.png' %}"
      alt="Reparto de Yo Heladerías" width="180" height="180" loading="eager">
  </div>
</section>

<div class="container pt-2 pb-5" id="nuestro-catalogo">
  <!-- ===== Título ===== -->
  <h2 class="py-title">Nuestro Catálogo</h2>

  <!-- ===== Búsqueda ===== -->
  <form method="get" class="py-search">
    <i class="bi bi-search"></i>
    <input name="q" value="{{ q }}" autocomplete="off" placeholder="Buscar productos..." />
    {% if cat %}<input type="hidden" name="cat" value="{{ cat }}">{% endif %}
    {% if sort %}<input type="hidden" name="sort" value="{{ sort }}">{% endif %}
    {% if q %}
      <a class="clear" href="?{% if cat %}cat={{ cat }}&{% endif %}{% if sort %}sort={{ sort }}{% endif %}">
        <i class="bi bi-x-circle"></i>
      </a>
    {% endif %}
  </form>

  <!-- ===== Chips de categorías (SIN “Menú”) ===== -->
  <div class="py-chips" id="cat-chips">
    {% for c in categorias %}
      <a
        data-cat="{{ c.id }}"
        data-name="{{ c.nombre }}"
        href="?cat={{ c.id }}{% if q %}&q={{ q }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}"
        class="chip
          {% if cat == c.id %}
            active
          {% elif not cat and c.nombre|lower == 'potes' %}
            active
          {% endif %}">
        {{ c.nombre }}
      </a>
    {% endfor %}
  </div>

  <!-- ===== Ordenamientos ===== -->
  <div class="py-filters">
    <a class="pill {% if sort == 'recientes' %}active{% endif %}"
       href="?{% if cat %}cat={{ cat }}&{% endif %}{% if q %}q={{ q }}&{% endif %}sort=recientes">Más nuevos</a>
    <a class="pill {% if sort == 'precio_asc' %}active{% endif %}"
       href="?{% if cat %}cat={{ cat }}&{% endif %}{% if q %}q={{ q }}&{% endif %}sort=precio_asc">Precio más bajo</a>
    <a class="pill {% if sort == 'precio_desc' %}active{% endif %}"
       href="?{% if cat %}cat={{ cat }}&{% endif %}{% if q %}q={{ q }}&{% endif %}sort=precio_desc">Precio más alto</a>
    <a class="pill {% if sort == 'nombre' %}active{% endif %}"
       href="?{% if cat %}cat={{ cat }}&{% endif %}{% if q %}q={{ q }}&{% endif %}sort=nombre">A–Z</a>
  </div>

  <!-- ===== Lista tipo PedidosYa ===== -->
  <div class="product-list">
    {% for p in productos %}
      <a class="tile" href="{% url 'detalle_producto' p.id %}">
        <div class="tile-info">
          <h3 class="tile-title">{{ p.nombre }}</h3>
          {% if p.sabores_maximos and p.sabores_maximos > 0 %}
            <div class="tile-sub">Hasta {{ p.sabores_maximos }} sabores.</div>
          {% endif %}
          <div class="tile-price">$ {{ p.precio|floatformat:0 }}</div>
          <div class="tile-cta">Ver detalles</div>
        </div>
        <div class="tile-media">
          {% if p.imagen %}
            {% if p.imagen.url %}
              <img loading="lazy" src="{{ p.imagen.url }}" alt="{{ p.nombre }}">
            {% else %}
              <img loading="lazy" src="{% static p.imagen %}" alt="{{ p.nombre }}">
            {% endif %}
          {% else %}
            <img loading="lazy" src="{% static 'pedidos/img/no-image.png' %}" alt="{{ p.nombre }}">
          {% endif %}
        </div>
      </a>
    {% empty %}
      <div class="alert alert-light border mt-3">No encontramos productos para tu búsqueda.</div>
    {% endfor %}
  </div>
</div>

<!-- Redirección suave a “Potes” por defecto si no hay ?cat= -->
<script>
(function(){
  const params = new URLSearchParams(location.search);
  if (params.has('cat')) return;

  const chips = document.querySelectorAll('#cat-chips a');
  if (!chips.length) return;

  // Busca “Potes”, si no existe usa la primera categoría
  let target = Array.from(chips).find(a => (a.dataset.name || '').toLowerCase() === 'potes') || chips[0];

  const p = new URLSearchParams(location.search);
  p.set('cat', target.dataset.cat);
  // preserva q y sort si ya estaban
  location.replace(location.pathname + '?' + p.toString());
})();
</script>

<style>
/* ===== HERO (imagen también en mobile) ===== */
.hero-card{
  display:grid;
  grid-template-columns: 1fr 92px; /* texto + imagen pequeña en mobile */
  align-items:center;
  gap:12px;
  background: linear-gradient(135deg,#0d47a1,#0a61c9);
  color:#fff;
  padding:14px 16px;
  border-radius:16px;
  margin:0 12px 8px;
  box-shadow:0 6px 20px rgba(13,71,161,.25);
}
.hero-copy h1{
  font-size:1.28rem; line-height:1.18; margin:0 0 6px; font-weight:800; letter-spacing:.2px;
}
.hero-copy p{ margin:0; font-size:.95rem; opacity:.95; } /* sin botón, menos margen */
.hero-illustration img{
  width:92px; height:auto; display:block; object-fit:contain;
  filter: drop-shadow(0 3px 8px rgba(0,0,0,.2));
}
@media (min-width:768px){
  .hero-card{ grid-template-columns: 1fr 220px; padding:22px 24px; margin:0 12px 12px; border-radius:18px; }
  .hero-copy h1{ font-size:2rem; }
  .hero-copy p{ font-size:1.05rem; }
  .hero-illustration img{ width:220px; }
}

/* ===== Catálogo tipo PedidosYa ===== */
.py-title{ font-weight:800; font-size:1.4rem; margin:8px 0 10px 2px; }
.py-search{
  position:relative; display:flex; align-items:center;
  background:#fff; border:1px solid #e5e7eb; border-radius:12px;
  padding:8px 12px; gap:8px; margin:0 2px 8px;
}
.py-search i{font-size:1.1rem; color:#6b7280}
.py-search input{ border:0; outline:none; width:100%; font-size:1rem; background:transparent; }
.py-search .clear{color:#9ca3af; font-size:1.1rem}

.py-chips{
  display:flex; gap:8px; overflow-x:auto; padding:4px 2px 8px;
  scrollbar-width:none; -ms-overflow-style:none; margin:0 2px 6px;
}
.py-chips::-webkit-scrollbar{display:none}
.chip{
  white-space:nowrap; padding:6px 12px; border-radius:999px;
  border:1px solid #e5e7eb; background:#fff; color:#111827; text-decoration:none;
  font-weight:600; font-size:.9rem;
}
.chip.active{ background:#0d6efd; border-color:#0d6efd; color:#fff }

.py-filters{ display:flex; gap:8px; overflow-x:auto; margin:0 2px 12px }
.pill{
  padding:6px 12px; border-radius:999px; background:#f3f4f6; color:#111827;
  text-decoration:none; font-weight:600; font-size:.9rem; white-space:nowrap;
}
.pill.active{ background:#111827; color:#fff }

.product-list{ display:grid; grid-template-columns:1fr; gap:12px }
.tile{
  display:grid; grid-template-columns:1fr 110px; gap:12px; align-items:center;
  background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:12px;
  text-decoration:none; color:inherit; box-shadow:0 1px 0 rgba(0,0,0,.02);
}
.tile:hover{ border-color:#d1d5db }
.tile-media img{ width:110px; height:110px; object-fit:cover; border-radius:12px; }
.tile-title{ font-size:1.05rem; line-height:1.2; margin:0 0 4px; font-weight:800 }
.tile-sub{ color:#6b7280; font-size:.9rem; margin-bottom:6px }
.tile-price{ font-weight:800; font-size:1.05rem; margin-bottom:4px }
.tile-cta{ font-size:.9rem; color:#0d6efd; font-weight:700 }
@media (min-width:768px){
  .product-list{ grid-template-columns:1fr 1fr; }
  .tile{ grid-template-columns:1fr 140px; }
  .tile-media img{ width:140px; height:140px; }
}
</style>
{% endblock %}
